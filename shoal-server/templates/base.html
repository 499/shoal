<!DOCTYPE html>
<html>
  <head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
	<meta http-equiv="refresh" content="30" />
    <meta charset="utf-8">
	<title>
      Shoal | Realtime Squid Monitoring System
    </title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
	<script src="jquery-1.10.2.min.js"></script>
    <style type="text/css">

	html, body, #map {
	  width: 100%;
	  height: 100%;
	  margin: 0;
	  padding: 0;
	}

	.stations, .stations svg {
	  position: absolute;
	}

	.stations svg {
	  width: 60px;
	  height: 20px;
	  padding-right: 100px;
	  font: 10px sans-serif;
	}

	.stations circle {
	  fill: brown;
	  stroke: black;
	  stroke-width: 1.5px;
	}
	</style>
	<link href="{{static_url("css/bootstrap.min.css")}}" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
	<link href="{{static_url("css/bootstrap-responsive.min.css")}}" rel="stylesheet">
    <link href="{{static_url("img/icons/favicon.ico")}}" rel="shortcut icon" type="image/x-icon">
  </head>
  
  
  <body>

	<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href='#'>Shoal</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Latest</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  Services
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="/wpad.dat"><i class="icon-file"></i> WPAD file</a></li>
                    <li class="dropdown-submenu">
                      <a tabindex="-1" href="#"><i class="icon-th-list"></i> Nearest Squid</a>
                      <ul class="dropdown-menu">
                        <li><a href="/nearest/1"><i class="icon-play"></i> Return 1</a></li>
                        <li><a href="/nearest/10"><i class="icon-forward"></i> Return 10</a></li>
                        <li><a href="/nearest/100"><i class="icon-fast-forward"></i> Return 100</a></li>
                      </ul>
                    </li>
               </ul>
             </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
  
	<div id="map">
	</div>
	
	
    <script type="text/javascript">
		// Create the Google Map…
		var map = new google.maps.Map(d3.select("#map").node(), {
		  zoom: 3,
		  center: new google.maps.LatLng(23.75, -10),
		  mapTypeId: google.maps.MapTypeId.TERRAIN
		});

		// Load the station data. When the data comes back, create an overlay.
		d3.json("nearest/1000", function(data) {
		  var overlay = new google.maps.OverlayView();

		  // Add the container when the overlay is added to the map.
		  overlay.onAdd = function() {
			var layer = d3.select(this.getPanes().overlayLayer).append("div")
				.attr("class", "stations");

			// Draw each marker as a separate SVG element.
			// We could use a single SVG, but what size would it have?
			overlay.draw = function() {
			  var projection = this.getProjection(),
				  padding = 10;

			  var marker = layer.selectAll("svg")
				  .data(d3.entries(data))
				  .each(transform) // update existing markers
				.enter().append("svg:svg")
				  .each(transform)
				  .attr("class", "marker");

			  // Add a circle.
			  marker.append("svg:circle")
				  .attr("r", 4.5)
				  .attr("cx", padding)
				  .attr("cy", padding);
				  
			  /*marker.append("svg:image")
				.attr('x',-20)
				.attr('y',-12)
				.attr('width', 100)
				.attr('height', 100)
				.attr("xlink:href","icon.jpg")*/

			  // Add a label.
			  marker.append("svg:text")
				  .attr("x", padding + 7)
				  .attr("y", padding)
				  .attr("dy", ".31em")
				  .text(function(d) { return d.key; });

			  function transform(d) {
				var geoData = d.value[0].geo_data;
				d = new google.maps.LatLng(geoData.latitude, geoData.longitude);
				//var copy = d;
				//d = new google.maps.LatLng(d.value[1], d.value[0]);
				d = projection.fromLatLngToDivPixel(d);
				return d3.select(this)
					.style("left", (d.x - padding) + "px")
					.style("top", (d.y - padding) + "px");
			  }
			};
		  };

		  // Bind our overlay to the map…
		  overlay.setMap(map);
		});
    </script>
	<div class="container-fluid">
      <div class="row-fluid">
	  {% block body %}
	  {% end %}
	  </div>
      <hr>
      <div class="row-fluid">
        <div class="span12">
          <footer id="footer" style="text-align:center">
            <div>
              &copy; University of Victoria  ||  <a href="http://github.com/hep-gc/shoal">Visit GitHub Project</a><i class="icon-hand-up"></i>
            </div>
          </footer>
        </div>
      </div>
    </div> <!-- /container -->
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{{static_url("js/jquery.min.js")}}"></script>
    <script src="{{static_url("js/bootstrap.min.js")}}"></script>
  </body>
</html>