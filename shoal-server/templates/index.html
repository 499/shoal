{% extends base.html %}

{% block body %}
<div class="row-fluid">
    <div class="span6 offset3" style="text-align:center">

        <h2>List of Active Squids</h2>
        {% if len(shoal) > 0 %}
            <h5 class="text-success">{{len(shoal)}} active in the last {{inactive_time}} seconds</h5>
        {% else %}
            <h5 class="text-info">None active in the last {{inactive_time}} seconds</h5>
        {% end %}
        </div>
<div class="row-fluid">
  <div class='span12'>
    <table class="table table-condensed table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>Hostname</th>
          <th class="hidden-phone">Public IP</th>
          <th class="hidden-phone">Private IP</th>
          <th>Bytes Out</th>
          <th>City</th>
          <th>Region</th>
          <th class="hidden-phone">Country</th>
          <th class="hidden-phone">Latitude</th>
          <th class="hidden-phone">Longitude</th>
          <th class="hidden-phone">Last Received</th>
          <th>Alive</th>
        </tr>
      </thead>
      <tbody>
        {% for squid in xrange(len(shoal)) %}
            {% set last_msg = int(int(now) - shoal[squid]['last_active']) %}
            {% set alive_time = int(now - shoal[squid]['timestamp']) %}
            {% set hour = int(alive_time/60/60) %}
            {% set minute = (alive_time - hour*60*60) / 60 %}
            {% set second = alive_time - hour*60*60 - minute*60 %}
            {% set status = 'success' %}
            {% if last_msg < inactive_time/3 %}
                {% set state = 'success' %}
            {% elif last_msg >= inactive_time/3 and last_msg < inactive_time*2/3 %}
                {% set state = 'warning' %}
            {% else %}
                {% set state = 'error' %}
            {% end %}

            <tr class='{{(state)}}'>
                <td><span class="badge badge-{{(state)}}">{{(squid+1)}}</td>
                <td>{{shoal[squid]['hostname']}}</td>
                <td class="hidden-phone">{{shoal[squid]['public_ip']}}</td>
                <td class="hidden-phone">{{shoal[squid]['private_ip']}}</td>
                <td>{{shoal[squid]['load']}} kB/s</td>
                <td>{{shoal[squid]['geo_data']['city']}}</td>
                <td class="hidden-phone">{{shoal[squid]['geo_data']['country_code3']}}</td>
                <td>{{shoal[squid]['geo_data']['region_code']}}</td>
                <td class="hidden-phone">{{shoal[squid]['geo_data']['latitude']}}</td>
                <td class="hidden-phone">{{shoal[squid]['geo_data']['longitude']}}</td>
                <td class="hidden-phone">{{(last_msg)}}s</td>
                <td>{{(hour)}}h {{(minute)}}m {{(second)}}s</td>
            </tr>
        {% end %}
      </tbody>
    </table>
  </div>
</div>
{% end %}
